<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>店家訊息處理工具</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:Arial,sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;padding:20px}
.container{max-width:1200px;margin:0 auto;background:rgba(255,255,255,.95);border-radius:20px;box-shadow:0 20px 40px rgba(0,0,0,.1);backdrop-filter:blur(10px);overflow:hidden}
.header{background:linear-gradient(135deg,#4facfe 0%,#00f2fe 100%);color:#fff;padding:30px;text-align:center}
.header h1{font-size:2.2rem;margin-bottom:10px;text-shadow:0 2px 4px rgba(0,0,0,.3)}
.header p{opacity:.9}
.content{padding:30px}
.input-section{margin-bottom:30px}
.input-section label{display:block;font-size:1.1rem;font-weight:700;margin-bottom:10px;color:#333}
.input-section textarea{width:100%;height:220px;padding:15px;border:2px solid #e0e0e0;border-radius:10px;font-size:1rem;resize:vertical;transition:border-color .3s}
.input-section textarea:focus{outline:none;border-color:#4facfe;box-shadow:0 0 10px rgba(79,172,254,.3)}
.button-section{display:flex;gap:14px;margin-bottom:24px;justify-content:center;flex-wrap:wrap}
.btn{padding:12px 22px;font-size:1rem;font-weight:700;border:none;border-radius:10px;cursor:pointer;transition:all .2s;text-transform:uppercase;letter-spacing:.5px}
.btn-primary{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff}
.btn-secondary{background:linear-gradient(135deg,#f093fb 0%,#f5576c 100%);color:#fff}
.btn-copy{background:linear-gradient(135deg,#43e97b 0%,#38f9d7 100%);color:#fff}
.btn:hover{transform:translateY(-2px);box-shadow:0 10px 20px rgba(0,0,0,.2)}
.result-title{font-size:1.1rem;font-weight:700;margin:10px 0;color:#333;border-bottom:2px solid #4facfe;padding-bottom:6px}
.result-box{background:#f8f9fa;border:2px solid #e9ecef;border-radius:10px;padding:16px;min-height:120px;font-family:"Courier New",monospace;white-space:pre-wrap;line-height:1.6}
@media(max-width:768px){.button-section{flex-direction:column}.content{padding:20px}}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>🏪 店家訊息處理工具</h1>
    <p>模糊比對 × 智慧整理 × 一鍵複製</p>
  </div>
  <div class="content">
    <div class="input-section">
      <label for="originalMessage">原始店家訊息：</label>
      <textarea id="originalMessage" placeholder="把整段貼進來，例：\nWave 23:40 38人…"></textarea>
    </div>
    <div class="button-section">
      <button class="btn btn-primary" onclick="filterMessage()">篩選結果</button>
      <button class="btn btn-secondary" onclick="generateReport()">生成報告</button>
    </div>

    <div class="result-title">篩選結果：</div>
    <div id="filteredResult" class="result-box"></div>

    <div class="result-title">ATT 報告：</div>
    <div id="attReportBox" class="result-box"></div>
    <button class="btn btn-copy" onclick="copyReport('attReportBox')">📋 複製 ATT 報告</button>

    <div class="result-title">A19 報告：</div>
    <div id="a19ReportBox" class="result-box"></div>
    <button class="btn btn-copy" onclick="copyReport('a19ReportBox')">📋 複製 A19 報告</button>
  </div>
</div>

<script>
// ====== 模糊比對關鍵字 -> 正式店名 ======
const storeAliases = {
  "wave":"WAVE 夜店","ai":"AI 夜店","belles":"BELLES","frank":"FRANK","door":"The door","rule":"One rule","kara":"Kara Kara","social":"Social","wtnc":"WTNC","babylon":"BABYLON 酒吧","sing":"聚唱KTV信義店","新村":"新村",
  "ruff":"Ruff 夜店","obsi":"OBSI","dd":"DD 夜店","barcode":"BARCODE 酒吧","underlink":"UNDERLINK","sleep":"Sleep No More","mars":"Mars","cafe from mars":"Mars","la fin":"la fin","fakesober":"Fakesober"
};
const attStores=[{name:"WAVE 夜店",capacity:"805人"},{name:"AI 夜店",capacity:"750人"},{name:"BELLES",capacity:""},{name:"聚唱KTV信義店",capacity:""},{name:"BABYLON 酒吧",capacity:""},{name:"FRANK",capacity:""},{name:"The door",capacity:""},{name:"One rule",capacity:""},{name:"Kara Kara",capacity:""},{name:"WTNC",capacity:""},{name:"新村",capacity:""},{name:"Social",capacity:""}];
const a19Stores=[{name:"Ruff 夜店",capacity:"390人",default:"未營業"},{name:"OBSI",capacity:"456人",default:"未營業"},{name:"DD 夜店",capacity:"223人",default:"未營業"},{name:"BARCODE 酒吧",capacity:"",default:"未營業"},{name:"UNDERLINK",capacity:"",default:"未營業"},{name:"Sleep No More",capacity:"",default:"打烊"},{name:"la fin",capacity:"",default:"未營業"},{name:"Fakesober",capacity:"",default:"打烊"},{name:"Mars",capacity:"",default:"打烊"}];

function filterMessage(){
  let msg=document.getElementById('originalMessage').value;
  msg=msg.replace(/\d{1,2}[：:]\d{2}\s*打烊/g,'').replace(/打烊\s*\d{1,2}[：:]\d{2}/g,'').replace(/\d{1,2}[：:]\d{2}/g,'').replace(/無兄弟客?/g,'').replace(/[（(][^）)]*[）)]/g,'').replace(/(\d+)[位人](?!.*sing!go)/gi,'$1').replace(/[：:]/g,'').replace(/\s+/g,' ').trim();
  document.getElementById('filteredResult').textContent=msg;
}
function normalizeName(raw){const lower=raw.toLowerCase();for(const key in storeAliases){if(lower.includes(key.toLowerCase()))return storeAliases[key];}return null;}
function extractStatus(line){const lower=line.toLowerCase();if(lower.includes('無營業'))return '未營業';const withoutTimes=line.replace(/\d{1,2}[：:]\d{2}/g,'');if(lower.includes('sing')){const m=withoutTimes.match(/(\d+間\d+人)/);if(m)return m[1];}let m=withoutTimes.match(/(\d+)\s*[位人]/);if(!m)m=withoutTimes.match(/(?:^|[^\d])(\d{1,4})(?!\d)/);if(m)return (m[1]||m[0]).replace(/[^\d]/g,'');if(lower.includes('打烊'))return '打烊';return '預設';}
function generateReport(){
  const original=document.getElementById('originalMessage').value;
  const storeData={};const lines=original.split('\n');
  for(const rawLine of lines){const line=rawLine.trim();if(!line)continue;const namePart=line.split(/[：:]/)[0];const normalized=normalizeName(namePart);if(!normalized)continue;const status=extractStatus(line);storeData[normalized]=status;}
  let attReport="三張所報告：\n《ATT大樓內店家人數報告，守望代號321》\n";
  attStores.forEach(s=>{let status=storeData[s.name]??"預設";if(/^\d+$/.test(status))status+="人";const cap=s.capacity?`(容留人數：${s.capacity})`:"";attReport+=`${s.name}：${status}${cap}\n`;});
  let a19Report="三張所報告：\n《A19大樓內店家人數報告，守望代號320》\n";
  a19Stores.forEach(s=>{let status=storeData[s.name]??s.default;if(/^\d+$/.test(status))status+="人";const cap=s.capacity?`（容留人數：${s.capacity}）`:"";a19Report+=`${s.name}：${status}${cap}\n`;});
  document.getElementById('attReportBox').textContent=attReport;
  document.getElementById('a19ReportBox').textContent=a19Report;
}
function copyReport(id){const text=document.getElementById(id).textContent;navigator.clipboard.writeText(text).then(()=>alert("📋 報告已複製到剪貼簿！"));}
</script>
</body>
</html>
